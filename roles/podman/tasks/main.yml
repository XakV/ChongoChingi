---
- name: include centos vars
  include_vars: '8.yml'
  when: ansible_distribution_major_version == '8'

- name: reset modules
  command: "dnf module reset {{ item | split(':') | first }} -y"
  loop: "{{ container_modules }}"

- name: enable module
  command: "dnf module enable {{ item }} -y"
  loop: "{{ container_modules }}"

- name: install packages
  dnf:
    name: "{{ podman_pkgs }}"
    state: latest

- name: do the handlers before the service starts
  meta: flush_handlers

- name: activate podman user service
  systemd:
    name: podman
    state: restarted
    daemon-reload: yes
    scope: user
  become_user: zach

- name: activate podman system service
  systemd:
    name: "{{ item }}"
    state: restarted
    daemon-reload: yes
  loop:
    - 'crio'
    - 'podman'
